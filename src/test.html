<!DOCTYPE html>
<html>
  <head>
    <base href="./">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="application/javascript"> 
      // Handler for .ready() called.
      window.tiledeskSettings = 
      {
          // PRE:   
          projectid: "5f800466ee919d003454316d", //"5f4cf9efc85eca0012dcfe2a",
          isOpen: true, 
          // departmentID : "5f4d026b5ef9fa0045f10586",
          // projectid: "5f1802e79cf1b20012179257",
          // departmentID : "5f1fd9749cf1b20012391176",  calloutTimer:0,
          // isOpen:true,
          // persistence: 'session',
          // showWaitTime: false,
          // hideHeaderCloseButton: true,
          // lang : 'en',
          // align:'right',
          // userFullname: " ",
          // userEmail: "",
          // PROD: 
          // projectid: "5ee09bf5168dc700191dfb47",
          isLogEnabled: true,
          // marginX: "100px"
          // autoStart: false,
          // persistence: 'session'
          // startFromHome: true,
          //preChatForm: false,
          // tenant: "tenant test",
          // widgetTitle: "widget Title Test"
          // showAttachmentButton: false,
          //showAllConversations: false,
          privacyField: 'Accetto i termini della privacy <a style="text-transform: none" target="_blank" href="http://www.tiledesk.com/privacy.html">Privacy Policy</a>'
           
      };

      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); 
        js.id = id; //js.async=!0;
        // PRE
        js.src = "./launch.js"; //
        // js.src = "https://widget-pre.tiledesk.com/v2/launch.js"; 
        // PROD
        // js.src = "https://widget.tiledesk.com/v4/launch.js";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'tiledesk-jssdk'));
     

      window.tileDeskAsyncInit = function() {

        // var dateLoadPage = Date.now();
        // window.tiledesk.on('onConversationUpdated', function(event_data) {
        //   var dateConvUpdate = event_data.detail.conversation.timestamp
        //   console.log(" TRIGGER onConversationUpdated -> ", event_data.detail.conversation);
        //   console.log("dateLoadPage-> ", dateLoadPage);
        //   console.log("dateConvUpdate-> ", dateConvUpdate);
        //   if(dateLoadPage < dateConvUpdate){
        //     console.log(" NUOVO MESSAGGIO!!!");
        //   }
        // });

        // console.log("window.tileDeskAsyncInit()");
        // window.tiledesk.on('onMessageCreated', function(event_data) {
        //   console.log(" TRIGGER onMessageCreated -> ", event_data.detail);
        // });
        
        window.tiledesk.on('onAuthStateChanged', function (event_data) {
          /* passo event 
           -2: vengo da un reinit. NON SCATTA L'EVENTO;
           -1: vengo da un logout. NON SCATTA L'EVENTO;
            0: non sono loggato;
          200: sono loggato;
          400: errore. IN CASO DI ERRORE NON SCATTA L'EVENTO
          */
            console.log("onAuthStateChanged----> ", event_data.detail.event, "<------");
            if (!event_data.detail.isLogged) {
                console.log("!NOT logged, fired also on startup!");
                // window.tiledesk.setPreChatForm(true);
                //window.tiledesk.signInAnonymous();
                //window.tiledesk.signInWithCustomToken("JWT WRONG_TOKEN_eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiIxMjMiLCJmaXJzdG5hbWUiOiJtYXJpbyIsImxhc3RuYW1lIjoicm9zc2kiLCJlbWFpbCI6Im1hcmlvcm9zc2lAZW1haWwuY29tIiwiY3VzdG9tQXR0ciI6ImMxIiwic3ViIjoidXNlcmV4dGVybmFsIiwiYXVkIjoiaHR0cHM6Ly90aWxlZGVzay5jb20vcHJvamVjdHMvNWVjMjQ5OGY1YmRhMTQwMDM0Y2NlMjY3In0.DrupfEEu0rBzOF7zPYsoU5Yg0YlN_9v6dvduG2sbE8c");
                //window.tiledesk.signInWithCustomToken("JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiIxMjMiLCJmaXJzdG5hbWUiOiJtYXJpbyIsImxhc3RuYW1lIjoicm9zc2kiLCJlbWFpbCI6Im1hcmlvcm9zc2lAZW1haWwuY29tIiwiY3VzdG9tQXR0ciI6ImMxIiwic3ViIjoidXNlcmV4dGVybmFsIiwiYXVkIjoiaHR0cHM6Ly90aWxlZGVzay5jb20vcHJvamVjdHMvNWVjMjQ5OGY1YmRhMTQwMDM0Y2NlMjY3In0.J2QDzWxlou7dJzTIaOajJkN-yQ_EiJM6bLpJ7fm-EXM");
                //window.tiledesk.hide();
            } else {
              console.log("logged in, fired also on startup!");
              //window.tiledesk.show();
            }
        });
        // window.tiledesk.on('loadParams', function(event_data) { 
        // });
      };
      function approved() {
          window.tiledesk.setPrivacyPolicy();
      };
    </script>
  </head>
  <body>
    <button id="isApproved" onclick="approved()">
      SET APPROVED TRUE
    </button>
  </body>
</html>